# Developer Documentation & Workflows

This document outlines the architecture, internal logic, and development workflows for **XML Diff Master**.

## üèóÔ∏è Architecture

This project is a **Single-File Application** (`index.html`).
- **Language**: React + TypeScript (via Babel Standalone).
- **Styling**: Tailwind CSS (via CDN script).
- **Bundling**: None. The `index.html` file contains all application logic, components, and styles.
- **Components**: All React components (`App`, `Toolbar`, `XmlEditor`, etc.) are defined directly within the `<script type="text/babel">` block in `index.html`.

> **Note**: There may be `.tsx` files in the repository (`components/`, `App.tsx`) from a previous build setup. These are currently **deprecated**. The source of truth is `index.html`.

## üß† Key Algorithms

### 1. XML Formatting (`formatXML`)
The formatter uses a custom recursive serializer instead of standard `XMLSerializer` to provide "Pretty Printing" that respects XML semantics.

- **Structure vs. Mixed Content**:
  - The function checks `hasMixedContent(node)` (does the node contain text?).
  - **Structural Nodes**: Children are indented on new lines.
  - **Mixed Content Nodes** (e.g., `<p>Text <b>Bold</b></p>`): Children are kept on the same line to preserve sentence structure.
- **Normalization** (Key Feature):
  - If `settings.editor.normalizeWhitespace` is **ON**:
    - Internal whitespace in mixed content (newlines, tabs) is collapsed to a single space.
    - **Leading/Trailing Trim**: The *first* text node child is `trimStart()`-ed and the *last* text node child is `trimEnd()`-ed.
    - This allows "Pretty" XML (multiline mixed content) to diff cleanly against "Minified" XML.

### 2. XML Sorting (`sortXML`)
Sorting ensures semantic equivalence is easier to spot.
- **Attributes**: Always sorted alphabetically (e.g., `id` before `source`).
- **Elements**: Child elements are sorted by `tagName`.
  - **Constraint**: Sorting is **skipped** for nodes with Mixed Content to prevent breaking sentence order (e.g., "Hello <b>World</b>" must not become "<b>World</b> Hello").

### 3. Save / Persistence
- **State**: The `App` component holds `leftFileName` and `rightFileName`.
- **Logic**:
  - **Upload/Drop**: The filename is captured and stored.
  - **Paste**: Filename resets to `untitled.xml` (unless manual saving overwrites it).
  - **Save**: Generates a Blob and triggers a download with the stored filename.

## üõ†Ô∏è Development Workflow

### Making Changes
1. Open `index.html` in your code editor (VS Code recommended).
2. Edit the React code inside the `<script>` tag.
3. Save and **Refresh your Browser** to see changes. No compilation step needed!

### Adding Icons
Icons are inline SVG components defined at the top of the script.
To add a new icon:
1. Find an SVG icon (e.g., from Lucide or Heroicons).
2. Create a component:
   ```javascript
   const MyIcon = (props) => <Icon {...props}><path d="..." /></Icon>;
   ```
3. Use it in the UI: `<MyIcon size={16} />`.

### Offline Distribution
To package the app for offline use:
1. Download the libraries listed in the `<head>` comments (React, Babel, Diff, etc.).
2. Save them to a `lib/` folder.
3. Uncomment the "Offline Mode" script tags in `index.html`.

## üß™ Debugging
- Use **Browser DevTools** (F12).
- Source maps are generated by Babel Standalone, so you can often see component names in the React DevTools or Console.
- Common Error: `ReferenceError: settings is not defined`. Ensure helper functions like `formatXML` have `settings` passed to them, as they are defined outside the `App` component scope.
